{% extends "base.html" %}
{% load staticfiles %}
{% load humanize %} 
{% block head %}
<!-- DataTables -->
<link rel="stylesheet"
	href="{% static 'AdminLTE_plugins/datatables/dataTables.bootstrap.css' %}">
<!-- Our internal functions -->
<link rel="stylesheet" href="{% static "jQueryFileTree/jQueryFileTree.min.css" %}">
<script src="{% static 'js/sns.js' %}"></script>

{% endblock head %}
{% block content %}

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>
		Configuration  <small>{{ object.id }}</small>
	</h1>
	<ol class="breadcrumb">
		<li class="active">Configuration</li>
		<li>{{ instrument|default:request.user.profile.instrument }}</li>
		<li>{{ object }}</li>
	</ol>
</section>

<!-- Main content -->

	<section class="content">
      <div class="row">
        <!-- left column -->
        <div class="col-md-8 col-md-offset-2">
          <!-- general form elements -->
          <div class="box box-primary">
            <div class="box-header with-border">
              <h3 class="box-title">Configuration form</h3>
            </div>
            <!-- /.box-header -->
            <!-- form start -->
            <form role="form" action="" method="post">
            	{% csrf_token %}
              <div class="box-body">
                {{ form.as_p }}
              </div>
              <!-- /.box-body -->

			  <div class="box-footer">
                <button type="button" class="btn btn-default">Cancel</button>
                {% if form.instance.pk %}
                <button type="submit" class="btn btn-primary">Update</button>
                {% else %}
                <button type="submit" class="btn btn-primary">Save</button>
                {% endif %}
              </div>
            </form>
          </div>
          <!-- /.box -->
	</div>
	</div>
	</section>



{% include 'dirlist.html' %}

<!-- /.content -->
{% endblock %}

{% block body_end %}
<script src="{% static "jQueryFileTree/jQueryFileTree.min.js" %}"></script>
<!-- page script -->
<script>
	// Admin LTE requires these classes for better forms
	$("input").addClass("form-control");
	$("select").addClass("form-control");

	//
	// File browser code. Needs refactoring. 
	// Note the include above for the modal: include 'dirlist.html'
	//

	// keeps the selector to assign the selected file
	var selector;
	// Setting up jQuery to pass csrf tokens to Django when using ajax.
	$.ajaxSetup({
		data : {
			csrfmiddlewaretoken : '{{ csrf_token }}'
		}
	});

	// Loads the file browser
	$(document)
			.ready(
					function() {
						$('.browser')
								.fileTree(
										{
											script : "{% url 'dirlist' instrument=request.user.profile.instrument.icat_name|upper %}",
											expandSpeed : 100,
											collapseSpeed : 100,
											multiFolder : false
										}, function(file) {
											$(selector).val(file);
											$('#file_modal').modal('hide');
										}).on('filetreeclicked',
										function(e, data) {
											console.log(data);
										});
					});
	//All input fields ending in file:
	$( "input[name$='file']" ).attr('data-toggle', 'modal');
	$( "input[name$='file']" ).attr('data-target', '#file_modal');
	$( "input[name$='file']" ).on('click', function(event) {
		selector = this;
	});
	
	//$('#id_dark_current_file').attr('data-toggle', 'modal');
	//$('#id_dark_current_file').attr('data-target', '#file_modal');
	//$('#id_dark_current_file').on('click', function(event) {
	//	//event.preventDefault(); // To prevent following the link (optional)
	//	selector = this;
	//});
</script>
{% endblock body_end %}
