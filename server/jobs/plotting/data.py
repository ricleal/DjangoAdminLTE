'''
Created on Feb 12, 2016

@author: rhf
'''

from pprint import pprint
import StringIO
import csv
    
def iq_string_to_plot_format(content, legend = None):
    """
    transforms the content (as string) of a *_Iq.txt file:
    #  X      Y      E      DX
    0.00053555    0    0    0
    0.00056586    0    0    0
    0.000597885    0    0    0
    0.000631723    0    0    0
    0.000667475    0    0    0
    
    into json:
    {'X' : [],
    'Y' : [],
    'E' : [],
    'DX' : []}
    """
    
    content = content.replace("\t", " ")
    # Get rid of the '#'
    content = content[1:]
    ff = StringIO.StringIO(content)
    reader = csv.DictReader(ff, delimiter=' ', skipinitialspace=True )# dialect = dialect)
    data = {}
    for row in reader:
        print row
        for header, value in row.items():
            print header, value
            try:
                data[header].append(float(value))
            except KeyError:
                data[header] = [value]
    if legend:
        data["name"] = legend
        
    return data
        
# 
#     
#     
# f = """#  X      Y      E      DX
# 0.00053555    0    0    0
# 0.00056586    0    0    0
# 0.000597885    0    0    0
# 0.000631723    0    0    0
# 0.000667475    0    0    0
# 0.0266887    0.669371    0.00618833    0.000632926
# 0.0281992    0.568095    0.005371    0.000635111
# 0.0297951    0.475252    0.00477959    0.000636594
# 0.0314814    0.404863    0.00419242    0.00063864
# 0.0332631    0.341226    0.00369362    0.000640869
# 0.0351457    0.278968    0.00321582    0.000642752
# 0.0371348    0.237212    0.00285522    0.000645849
# 0.0392364    0.198557    0.00249955    0.000649589
# 0.041457    0.166103    0.00219137    0.000653506
# 0.0438033    0.137965    0.00193385    0.000657448
# 0.0462824    0.112934    0.00171573    0.000661976
# 0.0489018    0.0950719    0.00151528    0.00066802
# 0.0516694    0.0755923    0.00134336    0.000673701
# 0.0545937    0.0603377    0.00118266    0.000679904
# 0.0576834    0.0499914    0.00107497    0.000687393
# 0.0609481    0.039604    0.000976595    0.000697378
# 0.0643975    0.0318027    0.000917494    0.00070874
# 0.0680421    0.0293189    0.000926861    0.000721883
# 0.071893    0.027442    0.000968315    0.000738422
# 0.0759618    0.0258994    0.00106704    0.000754657
# 0.0802609    0.0240579    0.00128063    0.000771729
# 0.0848034    0.0256622    0.00154475    0.000794413
# 0.0896029    0.0241798    0.00340167    0.000822177
# 0.094674    0.0253705    0.00631607    0.000852537
# 0.100032    0.0251213    0.00781306    0.000883132
# 0.105694    0.0182546    0.00602224    0.000914377
# 0.111675    0.0317913    0.0190693    0.000944635
# 0.117996    0.0117723    0.00917963    0.000479188
# """
# 
# pprint (iq_string_to_plot_format(f))

